{"changed":true,"filter":false,"title":"entrypoint.sh","tooltip":"/entrypoint.sh","value":"#!/bin/sh\n\nMONIKER=d1523b1c-85a1-40fb-8b55-6bf6d9ae0a0a &&\n    while [ ${#} -gt 0 ]\n    do\n        case ${1} in\n            --moniker)\n                MONIKER=\"${2}\" &&\n                    shift 2\n            ;;\n            --cloud9-port)\n                export CLOUD9_PORT=\"${2}\" &&\n                    shift 2\n            ;;\n            --project-name)\n                export PROJECT_NAME=\"${2}\" &&\n                    shift 2\n            ;;\n            --user-name)\n                export USER_NAME=\"${2}\" &&\n                    shift 2\n            ;;\n            --user-email)\n                export USER_EMAIL=\"${2}\" &&\n                    shift 2\n            ;;\n            --gpg-secret-key)\n                export GPG_SECRET_KEY=\"${2}\" &&\n                    shift 2\n            ;;\n            --gpg2-secret-key)\n                export GPG2_SECRET_KEY=\"${2}\" &&\n                    shift 2\n            ;;\n            --gpg-owner-trust)\n                export GPG_OWNER_TRUST=\"${2}\" &&\n                    shift 2\n            ;;\n            --gpg2-owner-trust)\n                export GPG2_OWNER_TRUST=\"${2}\" &&\n                    shift 2\n            ;;\n            --gpg-key-id)\n                export GPG_KEY_ID=\"${2}\" &&\n                    shift 2\n            ;;\n            --secrets-organization)\n                export SECRETS_ORGANIZATION=\"${2}\" &&\n                    shift 2\n            ;;\n            --secrets-repository)\n                export SECRETS_REPOSITORY=\"${2}\" &&\n                    shift 2\n            ;;\n            --docker-semver)\n                export DOCKER_SEMVER=\"${2}\" &&\n                    shift 2\n            ;;\n            --browser-semver)\n                export BROWSER_SEMVER=\"${2}\" &&\n                    shift 2\n            ;;\n            --middle-semver)\n                export MIDDLE_SEMVER=\"${2}\" &&\n                    shift 2\n            ;;\n            --inner-semver)\n                export INNER_SEMVER=\"${2}\" &&\n                    shift 2\n            ;;\n            *)\n                echo Unsupported Option &&\n                    echo ${0} &&\n                    echo ${@} &&\n                    exit 64\n            ;;\n        esac\n    done &&\n    if [ -z \"${CLOUD9_PORT}\" ]\n    then\n        echo Unspecified CLOUD9_PORT &&\n            exit 65\n    fi &&\n    if [ -z \"${PROJECT_NAME}\" ]\n    then\n        echo Unspecified PROJECT_NAME &&\n            exit 66\n    fi &&\n    if [ -z \"${USER_NAME}\" ]\n    then\n        echo Unspecified USER_NAME &&\n            exit 67\n    fi &&\n    if [ -z \"${USER_EMAIL}\" ]\n    then\n        echo Unspecified USER_EMAIL &&\n            exit 68\n    fi &&\n    if [ -z \"${GPG_SECRET_KEY}\" ]\n    then\n        echo Unspecified GPG_SECRET_KEY &&\n            exit 69\n    fi &&\n    if [ -z \"${GPG2_SECRET_KEY}\" ]\n    then\n        echo Unspecified GPG2_SECRET_KEY &&\n            exit 70\n    fi &&\n    if [ -z \"${GPG_OWNER_TRUST}\" ]\n    then\n        echo Unspecified GPG_OWNER_TRUST &&\n            exit 71\n    fi &&\n    if [ -z \"${GPG2_OWNER_TRUST}\" ]\n    then\n        echo Unspecified GPG2_OWNER_TRUST &&\n            exit 72\n    fi &&\n    if [ -z \"${SECRETS_ORGANIZATION}\" ]\n    then\n        echo Unspecified SECRETS_ORGANIZATION &&\n            exit 73\n    fi &&\n    if [ -z \"${SECRETS_REPOSITORY}\" ]\n    then\n        echo Unspecified SECRETS_REPOSITORY &&\n            exit 74\n    fi &&\n    if [ -z \"${DOCKER_SEMVER}\" ]\n    then\n        echo Unspecified DOCKER_SEMVER &&\n            exit 75\n    fi &&\n    if [ -z \"${BROWSER_SEMVER}\" ]\n    then\n        echo Unspecified BROWSER_SEMVER &&\n            exit 76\n    fi &&\n    if [ -z \"${MIDDLE_SEMVER}\" ]\n    then\n        echo Unspecified MIDDLE_SEMVER &&\n            exit 77\n    fi &&\n    cleanup(){\n        sudo --preserve-env docker stop $(cat registry) $(cat docker) $(cat middle) &&\n            sudo --preserve-env docker rm -fv $(cat registry) $(cat docker) $(cat middle) &&\n            sudo --preserve-env docker ps --quiet --all --filter label=expiry | while read ID\n            do\n                echo LOG A 1 &&\n                    if [ $(sudo --preserve-env docker inspect --format \"{{ .Config.Labels.expiry }}\" ${ID}) -lt $(date +%s) ]\n                    then\n                        sudo --preserve-env docker rm -v ${ID}\n                    fi &&\n                    echo LOG B1\n            done &&\n            sudo --preserve-env docker volume ls --quiet | while read VOLUME\n            do\n                echo LOG A 3 &&\n                    if [ \"$(sudo --preserve-env docker volume inspect --format \\\"{{.Labels.expiry}}\\\" ${VOLUME})\" != \"\\\"<no value>\\\"\" ] && [ $(sudo --preserve-env docker volume inspect --format \"{{.Labels.expiry}}\" ${VOLUME}) -lt $(date +%s) ]\n                    then\n                        sudo --preserve-env docker volume rm ${VOLUME}\n                    fi &&\n                    echo LOG B 3\n            done\n    } &&\n    trap cleanup EXIT &&\n    IMAGE_VOLUME=$(sudo --preserve-env docker volume ls --quiet | while read VOLUME\n    do\n        echo LOG A 4 &&\n            if [ \"$(sudo --preserve-env docker volume inspect --format \\\"{{.Labels.moniker}}\\\" ${VOLUME})\" == \"\\\"${MONIKER}\\\"\" ]\n            then    \n                echo ${VOLUME}\n            fi &&\n            echo LOG B 4\n    done | head -n 1) &&\n    if [ -z \"${REGISTRY_VOLUME}\" ]\n    then\n        REGISTRY_VOLUME=$(sudo docker volume create --label moniker=${MONIKER} --label expiry=$(($(date +%s)+60*60*24*7)))\n    fi &&\n    sudo --preserve-env docker create --cidfile registry --volume ${REGISTRY_VOLUME}:/var/lib/registry registry:2.6.2 &&\n    sudo \\\n        --preserve-env \\\n        docker \\\n        create \\\n        --cidfile docker \\\n        --privileged \\\n        --volume /:/srv/host:ro \\\n        --volume ${REGISTRY_VOLUME}:/var/lib/docker \\\n        --label expiry=$(($(date +%s)+60*60*24*7)) \\\n        docker:${DOCKER_SEMVER}-ce-dind \\\n            --host tcp://0.0.0.0:2376 &&\n    sudo --preserve-env docker start $(cat docker) $(cat registry) &&\n    sleep 5s &&\n    sudo --preserve-env docker exec --interactive $(cat docker) adduser -D user &&\n    sudo --preserve-env docker exec --interactive $(cat docker) mkdir /home/user/workspace &&\n    sudo --preserve-env docker exec --interactive $(cat docker) chown user:user /home/user/workspace &&\n    echo LOG A 5 &&\n    sudo --preserve-env docker inspect --format \"{{.NetworkSettings.Networks.bridge.IPAddress}}\" | sudo --preserve-env docker exec --interactive $(cat docker) tee -a /etc/hosts &&\n    echo LOG B 5 &&\n    (cat > ${TFILE} <<EOF\n{\n    \"insecure-registries\": [\"registry:5000\"]\n}\nEOF\n    ) | sudo --preserve-env docker exec --interactive $(cat docker) tee /etc/docker/daemon.json &&\n    sudo --preserve-env docker restart $(cat docker) $(cat registry) &&\n    sleep 5s &&\n    echo LOG A 6 &&\n    sudo \\\n        --preserve-env \\\n        docker \\\n        create \\\n        --cidfile middle \\\n        --interactive \\\n        --env DISPLAY \\\n        --env DOCKER_HOST \\\n        --env CLOUD9_PORT \\\n        --env PROJECT_NAME \\\n        --env USER_NAME \\\n        --env USER_EMAIL \\\n        --env GPG_SECRET_KEY \\\n        --env GPG2_SECRET_KEY \\\n        --env GPG_OWNER_TRUST \\\n        --env GPG2_OWNER_TRUST \\\n        --env GPG_KEY_ID \\\n        --env SECRETS_ORGANIZATION \\\n        --env SECRETS_REPOSITORY \\\n        --env DOCKER_SEMVER \\\n        --env BROWSER_SEMVER \\\n        --env MIDDLE_SEMVER \\\n        --env INNER_SEMVER \\\n        --env DOCKER_HOST=$(sudo --preserve-env docker inspect --format \"tcp://{{ .NetworkSettings.Networks.bridge.IPAddress }}:2376\" $(cat docker)) \\\n        --label expiry=$(($(date +%s)+60*60*24*7)) \\\n        rebelplutonium/middle:${MIDDLE_SEMVER} \\\n            \"${@}\" &&\n    echo LOG B 6 &&\n    sudo --preserve-env docker start --interactive $(cat middle)","undoManager":{"mark":88,"position":100,"stack":[[{"start":{"row":196,"column":6},"end":{"row":196,"column":7},"action":"insert","lines":["h"],"id":340}],[{"start":{"row":196,"column":7},"end":{"row":196,"column":8},"action":"insert","lines":["o"],"id":341}],[{"start":{"row":196,"column":8},"end":{"row":196,"column":9},"action":"insert","lines":[" "],"id":342}],[{"start":{"row":196,"column":9},"end":{"row":196,"column":10},"action":"insert","lines":["L"],"id":343}],[{"start":{"row":196,"column":10},"end":{"row":196,"column":11},"action":"insert","lines":["O"],"id":344}],[{"start":{"row":196,"column":11},"end":{"row":196,"column":12},"action":"insert","lines":["G"],"id":345}],[{"start":{"row":196,"column":12},"end":{"row":196,"column":13},"action":"insert","lines":[" "],"id":346}],[{"start":{"row":196,"column":13},"end":{"row":196,"column":14},"action":"insert","lines":["4"],"id":347}],[{"start":{"row":196,"column":14},"end":{"row":196,"column":15},"action":"insert","lines":[" "],"id":348}],[{"start":{"row":196,"column":15},"end":{"row":196,"column":16},"action":"insert","lines":["A"],"id":349}],[{"start":{"row":196,"column":16},"end":{"row":196,"column":17},"action":"insert","lines":[" "],"id":350}],[{"start":{"row":196,"column":17},"end":{"row":196,"column":18},"action":"insert","lines":["&"],"id":351}],[{"start":{"row":196,"column":18},"end":{"row":196,"column":19},"action":"insert","lines":["&"],"id":352}],[{"start":{"row":197,"column":179},"end":{"row":198,"column":0},"action":"insert","lines":["",""],"id":353},{"start":{"row":198,"column":0},"end":{"row":198,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":198,"column":4},"end":{"row":198,"column":5},"action":"insert","lines":["e"],"id":354}],[{"start":{"row":198,"column":5},"end":{"row":198,"column":6},"action":"insert","lines":["c"],"id":355}],[{"start":{"row":198,"column":6},"end":{"row":198,"column":7},"action":"insert","lines":["h"],"id":356}],[{"start":{"row":198,"column":7},"end":{"row":198,"column":8},"action":"insert","lines":["o"],"id":357}],[{"start":{"row":198,"column":8},"end":{"row":198,"column":9},"action":"insert","lines":[" "],"id":358}],[{"start":{"row":198,"column":9},"end":{"row":198,"column":10},"action":"insert","lines":["L"],"id":359}],[{"start":{"row":198,"column":10},"end":{"row":198,"column":11},"action":"insert","lines":["O"],"id":360}],[{"start":{"row":198,"column":11},"end":{"row":198,"column":12},"action":"insert","lines":["G"],"id":361}],[{"start":{"row":198,"column":12},"end":{"row":198,"column":13},"action":"insert","lines":[" "],"id":362}],[{"start":{"row":198,"column":13},"end":{"row":198,"column":14},"action":"insert","lines":["4"],"id":363}],[{"start":{"row":198,"column":14},"end":{"row":198,"column":15},"action":"insert","lines":[" "],"id":364}],[{"start":{"row":198,"column":15},"end":{"row":198,"column":16},"action":"insert","lines":["B"],"id":365}],[{"start":{"row":198,"column":16},"end":{"row":198,"column":17},"action":"insert","lines":[" "],"id":366}],[{"start":{"row":198,"column":16},"end":{"row":198,"column":17},"action":"remove","lines":[" "],"id":367}],[{"start":{"row":198,"column":15},"end":{"row":198,"column":16},"action":"remove","lines":["B"],"id":368}],[{"start":{"row":198,"column":14},"end":{"row":198,"column":15},"action":"remove","lines":[" "],"id":369}],[{"start":{"row":198,"column":13},"end":{"row":198,"column":14},"action":"remove","lines":["4"],"id":370}],[{"start":{"row":198,"column":12},"end":{"row":198,"column":13},"action":"remove","lines":[" "],"id":371}],[{"start":{"row":198,"column":12},"end":{"row":198,"column":13},"action":"insert","lines":[" "],"id":372}],[{"start":{"row":198,"column":13},"end":{"row":198,"column":14},"action":"insert","lines":["B"],"id":373}],[{"start":{"row":198,"column":14},"end":{"row":198,"column":15},"action":"insert","lines":[" "],"id":374}],[{"start":{"row":198,"column":15},"end":{"row":198,"column":16},"action":"insert","lines":["4"],"id":375}],[{"start":{"row":198,"column":16},"end":{"row":198,"column":17},"action":"insert","lines":[" "],"id":376}],[{"start":{"row":198,"column":17},"end":{"row":198,"column":18},"action":"insert","lines":["&"],"id":377}],[{"start":{"row":198,"column":18},"end":{"row":198,"column":19},"action":"insert","lines":["&"],"id":378}],[{"start":{"row":196,"column":15},"end":{"row":196,"column":16},"action":"remove","lines":["A"],"id":379}],[{"start":{"row":196,"column":14},"end":{"row":196,"column":15},"action":"remove","lines":[" "],"id":380}],[{"start":{"row":196,"column":13},"end":{"row":196,"column":14},"action":"remove","lines":["4"],"id":381}],[{"start":{"row":196,"column":13},"end":{"row":196,"column":14},"action":"insert","lines":["A"],"id":382}],[{"start":{"row":196,"column":14},"end":{"row":196,"column":15},"action":"insert","lines":[" "],"id":383}],[{"start":{"row":196,"column":15},"end":{"row":196,"column":16},"action":"insert","lines":["4"],"id":384}],[{"start":{"row":157,"column":27},"end":{"row":157,"column":28},"action":"remove","lines":["2"],"id":385}],[{"start":{"row":157,"column":27},"end":{"row":157,"column":28},"action":"insert","lines":["3"],"id":386}],[{"start":{"row":162,"column":31},"end":{"row":162,"column":32},"action":"remove","lines":["2"],"id":387}],[{"start":{"row":162,"column":31},"end":{"row":162,"column":32},"action":"insert","lines":["3"],"id":388}],[{"start":{"row":168,"column":19},"end":{"row":168,"column":20},"action":"remove","lines":["3"],"id":389}],[{"start":{"row":168,"column":19},"end":{"row":168,"column":20},"action":"insert","lines":["4"],"id":390}],[{"start":{"row":173,"column":23},"end":{"row":173,"column":24},"action":"remove","lines":["3"],"id":391}],[{"start":{"row":173,"column":23},"end":{"row":173,"column":24},"action":"insert","lines":["4"],"id":392}],[{"start":{"row":196,"column":15},"end":{"row":196,"column":16},"action":"remove","lines":["4"],"id":393}],[{"start":{"row":196,"column":15},"end":{"row":196,"column":16},"action":"insert","lines":["5"],"id":394}],[{"start":{"row":198,"column":15},"end":{"row":198,"column":16},"action":"remove","lines":["4"],"id":395}],[{"start":{"row":198,"column":15},"end":{"row":198,"column":16},"action":"insert","lines":["5"],"id":396}],[{"start":{"row":144,"column":46},"end":{"row":144,"column":62},"action":"remove","lines":["registry) $(cat "],"id":397},{"start":{"row":145,"column":45},"end":{"row":145,"column":61},"action":"remove","lines":[" $(cat registry)"]},{"start":{"row":148,"column":16},"end":{"row":149,"column":20},"action":"remove","lines":["echo LOG A 1 &&","                    "]},{"start":{"row":149,"column":16},"end":{"row":149,"column":20},"action":"remove","lines":["    "]},{"start":{"row":150,"column":0},"end":{"row":150,"column":4},"action":"remove","lines":["    "]},{"start":{"row":151,"column":0},"end":{"row":151,"column":2},"action":"remove","lines":["  "]},{"start":{"row":151,"column":16},"end":{"row":151,"column":18},"action":"remove","lines":["  "]},{"start":{"row":151,"column":18},"end":{"row":152,"column":31},"action":"remove","lines":[" &&","                    echo LOG B1"]},{"start":{"row":153,"column":70},"end":{"row":153,"column":76},"action":"remove","lines":["VOLUME"]},{"start":{"row":153,"column":70},"end":{"row":153,"column":72},"action":"insert","lines":["ID"]},{"start":{"row":155,"column":16},"end":{"row":156,"column":20},"action":"remove","lines":["echo LOG A 3 &&","                    "]},{"start":{"row":155,"column":139},"end":{"row":155,"column":154},"action":"insert","lines":["date --date \"$("]},{"start":{"row":155,"column":205},"end":{"row":155,"column":206},"action":"insert","lines":["\\"]},{"start":{"row":155,"column":225},"end":{"row":155,"column":226},"action":"insert","lines":["\\"]},{"start":{"row":155,"column":237},"end":{"row":155,"column":239},"action":"insert","lines":[")\""]},{"start":{"row":156,"column":16},"end":{"row":156,"column":20},"action":"remove","lines":["    "]},{"start":{"row":157,"column":0},"end":{"row":157,"column":3},"action":"remove","lines":["   "]},{"start":{"row":157,"column":20},"end":{"row":157,"column":21},"action":"remove","lines":[" "]},{"start":{"row":158,"column":16},"end":{"row":158,"column":20},"action":"remove","lines":["    "]},{"start":{"row":158,"column":18},"end":{"row":159,"column":32},"action":"remove","lines":[" &&","                    echo LOG B 3"]},{"start":{"row":162,"column":4},"end":{"row":162,"column":13},"action":"remove","lines":["REGISTRY_"]},{"start":{"row":164,"column":8},"end":{"row":165,"column":12},"action":"remove","lines":["echo LOG A 4 &&","            "]},{"start":{"row":165,"column":8},"end":{"row":165,"column":12},"action":"remove","lines":["    "]},{"start":{"row":166,"column":0},"end":{"row":166,"column":4},"action":"remove","lines":["    "]},{"start":{"row":167,"column":8},"end":{"row":167,"column":12},"action":"remove","lines":["    "]},{"start":{"row":167,"column":10},"end":{"row":168,"column":24},"action":"remove","lines":[" &&","            echo LOG B 4"]},{"start":{"row":169,"column":15},"end":{"row":169,"column":24},"action":"remove","lines":["REGISTRY_"]},{"start":{"row":171,"column":8},"end":{"row":171,"column":14},"action":"insert","lines":["echo C"]},{"start":{"row":171,"column":16},"end":{"row":171,"column":20},"action":"insert","lines":["ATIN"]},{"start":{"row":171,"column":21},"end":{"row":171,"column":24},"action":"remove","lines":["IST"]},{"start":{"row":171,"column":21},"end":{"row":171,"column":33},"action":"insert","lines":[" A NEW DOCKE"]},{"start":{"row":171,"column":34},"end":{"row":171,"column":36},"action":"remove","lines":["Y_"]},{"start":{"row":171,"column":34},"end":{"row":172,"column":12},"action":"insert","lines":[" VOLUME &&","            "]},{"start":{"row":173,"column":4},"end":{"row":173,"column":9},"action":"remove","lines":["fi &&"]},{"start":{"row":173,"column":4},"end":{"row":173,"column":8},"action":"insert","lines":["else"]},{"start":{"row":174,"column":4},"end":{"row":174,"column":8},"action":"remove","lines":["sudo"]},{"start":{"row":174,"column":5},"end":{"row":174,"column":19},"action":"remove","lines":["--preserve-env"]},{"start":{"row":174,"column":6},"end":{"row":174,"column":12},"action":"remove","lines":["docker"]},{"start":{"row":174,"column":7},"end":{"row":174,"column":13},"action":"remove","lines":["create"]},{"start":{"row":174,"column":8},"end":{"row":174,"column":10},"action":"remove","lines":["--"]},{"start":{"row":174,"column":8},"end":{"row":174,"column":9},"action":"insert","lines":["e"]},{"start":{"row":174,"column":10},"end":{"row":174,"column":16},"action":"remove","lines":["idfile"]},{"start":{"row":174,"column":10},"end":{"row":174,"column":18},"action":"insert","lines":["ho USING"]},{"start":{"row":174,"column":19},"end":{"row":174,"column":27},"action":"remove","lines":["registry"]},{"start":{"row":174,"column":19},"end":{"row":174,"column":20},"action":"insert","lines":["A"]},{"start":{"row":174,"column":21},"end":{"row":174,"column":29},"action":"remove","lines":["--volume"]},{"start":{"row":174,"column":21},"end":{"row":174,"column":27},"action":"insert","lines":["CACHED"]},{"start":{"row":174,"column":28},"end":{"row":174,"column":31},"action":"remove","lines":["${R"]},{"start":{"row":174,"column":28},"end":{"row":174,"column":32},"action":"insert","lines":["DOCK"]},{"start":{"row":174,"column":33},"end":{"row":174,"column":37},"action":"remove","lines":["GIST"]},{"start":{"row":174,"column":34},"end":{"row":174,"column":36},"action":"remove","lines":["Y_"]},{"start":{"row":174,"column":34},"end":{"row":174,"column":35},"action":"insert","lines":[" "]},{"start":{"row":174,"column":41},"end":{"row":174,"column":60},"action":"remove","lines":["}:/var/lib/registry"]},{"start":{"row":174,"column":41},"end":{"row":175,"column":3},"action":"insert","lines":["","   "]},{"start":{"row":175,"column":4},"end":{"row":175,"column":7},"action":"remove","lines":["reg"]},{"start":{"row":175,"column":4},"end":{"row":175,"column":5},"action":"insert","lines":["f"]},{"start":{"row":175,"column":6},"end":{"row":175,"column":16},"action":"remove","lines":["stry:2.6.2"]},{"start":{"row":183,"column":19},"end":{"row":183,"column":28},"action":"remove","lines":["REGISTRY_"]},{"start":{"row":187,"column":51},"end":{"row":188,"column":13},"action":"remove","lines":["$(cat registry) &&","    sleep 5s "]},{"start":{"row":191,"column":0},"end":{"row":203,"column":0},"action":"remove","lines":["    echo LOG A 5 &&","    sudo --preserve-env docker inspect --format \"{{.NetworkSettings.Networks.bridge.IPAddress}}\" | sudo --preserve-env docker exec --interactive $(cat docker) tee -a /etc/hosts &&","    echo LOG B 5 &&","    (cat > ${TFILE} <<EOF","{","    \"insecure-registries\": [\"registry:5000\"]","}","EOF","    ) | sudo --preserve-env docker exec --interactive $(cat docker) tee /etc/docker/daemon.json &&","    sudo --preserve-env docker restart $(cat docker) $(cat registry) &&","    sleep 5s &&","    echo LOG A 6 &&",""]},{"start":{"row":217,"column":18},"end":{"row":218,"column":16},"action":"remove","lines":[" &&","    echo LOG B 6"]}],[{"start":{"row":162,"column":4},"end":{"row":162,"column":5},"action":"insert","lines":["I"],"id":398}],[{"start":{"row":162,"column":5},"end":{"row":162,"column":6},"action":"insert","lines":["M"],"id":399}],[{"start":{"row":162,"column":6},"end":{"row":162,"column":7},"action":"insert","lines":["A"],"id":400}],[{"start":{"row":162,"column":7},"end":{"row":162,"column":8},"action":"insert","lines":["G"],"id":401}],[{"start":{"row":162,"column":8},"end":{"row":162,"column":9},"action":"insert","lines":["E"],"id":402}],[{"start":{"row":162,"column":9},"end":{"row":162,"column":10},"action":"insert","lines":["_"],"id":403}],[{"start":{"row":169,"column":15},"end":{"row":169,"column":16},"action":"insert","lines":["I"],"id":404}],[{"start":{"row":169,"column":16},"end":{"row":169,"column":17},"action":"insert","lines":["M"],"id":405}],[{"start":{"row":169,"column":17},"end":{"row":169,"column":18},"action":"insert","lines":["A"],"id":406}],[{"start":{"row":169,"column":18},"end":{"row":169,"column":19},"action":"insert","lines":["G"],"id":407}],[{"start":{"row":169,"column":19},"end":{"row":169,"column":20},"action":"insert","lines":["E"],"id":408}],[{"start":{"row":169,"column":20},"end":{"row":169,"column":21},"action":"insert","lines":["_"],"id":409}],[{"start":{"row":172,"column":12},"end":{"row":172,"column":13},"action":"insert","lines":["I"],"id":410}],[{"start":{"row":172,"column":13},"end":{"row":172,"column":14},"action":"insert","lines":["M"],"id":411}],[{"start":{"row":172,"column":14},"end":{"row":172,"column":15},"action":"insert","lines":["A"],"id":412}],[{"start":{"row":172,"column":15},"end":{"row":172,"column":16},"action":"insert","lines":["G"],"id":413}],[{"start":{"row":172,"column":16},"end":{"row":172,"column":17},"action":"insert","lines":["E"],"id":414}],[{"start":{"row":172,"column":17},"end":{"row":172,"column":18},"action":"insert","lines":["_"],"id":415}],[{"start":{"row":183,"column":19},"end":{"row":183,"column":20},"action":"insert","lines":["I"],"id":416}],[{"start":{"row":183,"column":20},"end":{"row":183,"column":21},"action":"insert","lines":["M"],"id":417}],[{"start":{"row":183,"column":21},"end":{"row":183,"column":22},"action":"insert","lines":["A"],"id":418}],[{"start":{"row":183,"column":22},"end":{"row":183,"column":23},"action":"insert","lines":["G"],"id":419}],[{"start":{"row":183,"column":23},"end":{"row":183,"column":24},"action":"insert","lines":["E"],"id":420}],[{"start":{"row":183,"column":24},"end":{"row":183,"column":25},"action":"insert","lines":["_"],"id":421}],[{"start":{"row":183,"column":48},"end":{"row":183,"column":49},"action":"insert","lines":["/"],"id":422}],[{"start":{"row":183,"column":49},"end":{"row":183,"column":50},"action":"insert","lines":["i"],"id":423}],[{"start":{"row":183,"column":50},"end":{"row":183,"column":51},"action":"insert","lines":["m"],"id":424}],[{"start":{"row":183,"column":51},"end":{"row":183,"column":52},"action":"insert","lines":["a"],"id":425}],[{"start":{"row":183,"column":52},"end":{"row":183,"column":53},"action":"insert","lines":["g"],"id":426}],[{"start":{"row":183,"column":53},"end":{"row":183,"column":54},"action":"insert","lines":["e"],"id":427}],[{"start":{"row":144,"column":46},"end":{"row":144,"column":62},"action":"insert","lines":["registry) $(cat "],"id":428},{"start":{"row":145,"column":45},"end":{"row":145,"column":61},"action":"insert","lines":[" $(cat registry)"]},{"start":{"row":148,"column":16},"end":{"row":149,"column":20},"action":"insert","lines":["echo LOG A 1 &&","                    "]},{"start":{"row":150,"column":16},"end":{"row":150,"column":20},"action":"insert","lines":["    "]},{"start":{"row":151,"column":0},"end":{"row":151,"column":4},"action":"insert","lines":["    "]},{"start":{"row":152,"column":0},"end":{"row":152,"column":1},"action":"insert","lines":[" "]},{"start":{"row":152,"column":17},"end":{"row":152,"column":20},"action":"insert","lines":["   "]},{"start":{"row":152,"column":22},"end":{"row":153,"column":31},"action":"insert","lines":[" &&","                    echo LOG B1"]},{"start":{"row":155,"column":70},"end":{"row":155,"column":72},"action":"remove","lines":["ID"]},{"start":{"row":155,"column":70},"end":{"row":155,"column":76},"action":"insert","lines":["VOLUME"]},{"start":{"row":157,"column":16},"end":{"row":158,"column":20},"action":"insert","lines":["echo LOG A 3 &&","                    "]},{"start":{"row":158,"column":141},"end":{"row":158,"column":156},"action":"remove","lines":["$(date --date \""]},{"start":{"row":158,"column":194},"end":{"row":158,"column":195},"action":"remove","lines":["\\"]},{"start":{"row":158,"column":213},"end":{"row":158,"column":214},"action":"remove","lines":["\\"]},{"start":{"row":158,"column":225},"end":{"row":158,"column":227},"action":"remove","lines":["\")"]},{"start":{"row":159,"column":0},"end":{"row":159,"column":1},"action":"insert","lines":[" "]},{"start":{"row":159,"column":17},"end":{"row":159,"column":20},"action":"insert","lines":["   "]},{"start":{"row":160,"column":0},"end":{"row":160,"column":2},"action":"insert","lines":["  "]},{"start":{"row":160,"column":22},"end":{"row":160,"column":24},"action":"insert","lines":["  "]},{"start":{"row":161,"column":16},"end":{"row":161,"column":20},"action":"insert","lines":["    "]},{"start":{"row":161,"column":22},"end":{"row":162,"column":32},"action":"insert","lines":[" &&","                    echo LOG B 3"]},{"start":{"row":166,"column":0},"end":{"row":169,"column":0},"action":"insert","lines":["<<<<<<< HEAD","    REGISTRY_VOLUME=$(sudo --preserve-env docker volume ls --quiet | while read VOLUME","=======",""]},{"start":{"row":170,"column":0},"end":{"row":171,"column":0},"action":"insert","lines":[">>>>>>> only cache images",""]},{"start":{"row":172,"column":8},"end":{"row":173,"column":12},"action":"insert","lines":["echo LOG A 4 &&","            "]},{"start":{"row":174,"column":8},"end":{"row":174,"column":12},"action":"insert","lines":["    "]},{"start":{"row":175,"column":0},"end":{"row":175,"column":4},"action":"insert","lines":["    "]},{"start":{"row":176,"column":8},"end":{"row":176,"column":12},"action":"insert","lines":["    "]},{"start":{"row":176,"column":14},"end":{"row":177,"column":24},"action":"insert","lines":[" &&","            echo LOG B 4"]},{"start":{"row":178,"column":24},"end":{"row":183,"column":7},"action":"insert","lines":["","<<<<<<< HEAD","    if [ -z \"${REGISTRY_VOLUME}\" ]","    then","        REGISTRY_VOLUME=$(sudo docker volume create --label moniker=${MONIKER} --label expiry=$(($(date +%s)+60*60*24*7)))","======="]},{"start":{"row":190,"column":0},"end":{"row":191,"column":0},"action":"insert","lines":[">>>>>>> only cache images",""]},{"start":{"row":191,"column":6},"end":{"row":192,"column":117},"action":"insert","lines":[" &&","    sudo --preserve-env docker create --cidfile registry --volume ${REGISTRY_VOLUME}:/var/lib/registry registry:2.6.2"]},{"start":{"row":200,"column":0},"end":{"row":203,"column":0},"action":"insert","lines":["<<<<<<< HEAD","        --volume ${REGISTRY_VOLUME}:/var/lib/docker \\","=======",""]},{"start":{"row":204,"column":0},"end":{"row":205,"column":0},"action":"insert","lines":[">>>>>>> only cache images",""]},{"start":{"row":208,"column":51},"end":{"row":209,"column":13},"action":"insert","lines":["$(cat registry) &&","    sleep 5s "]},{"start":{"row":213,"column":0},"end":{"row":225,"column":0},"action":"insert","lines":["    echo LOG A 5 &&","    sudo --preserve-env docker inspect --format \"{{.NetworkSettings.Networks.bridge.IPAddress}}\" | sudo --preserve-env docker exec --interactive $(cat docker) tee -a /etc/hosts &&","    echo LOG B 5 &&","    (cat > ${TFILE} <<EOF","{","    \"insecure-registries\": [\"registry:5000\"]","}","EOF","    ) | sudo --preserve-env docker exec --interactive $(cat docker) tee /etc/docker/daemon.json &&","    sudo --preserve-env docker restart $(cat docker) $(cat registry) &&","    sleep 5s &&","    echo LOG A 6 &&",""]},{"start":{"row":251,"column":18},"end":{"row":252,"column":16},"action":"insert","lines":[" &&","    echo LOG B 6"]}],[{"start":{"row":166,"column":0},"end":{"row":168,"column":7},"action":"remove","lines":["<<<<<<< HEAD","    REGISTRY_VOLUME=$(sudo --preserve-env docker volume ls --quiet | while read VOLUME","======="],"id":429}],[{"start":{"row":165,"column":24},"end":{"row":166,"column":0},"action":"remove","lines":["",""],"id":430}],[{"start":{"row":167,"column":0},"end":{"row":167,"column":25},"action":"remove","lines":[">>>>>>> only cache images"],"id":431}],[{"start":{"row":166,"column":83},"end":{"row":167,"column":0},"action":"remove","lines":["",""],"id":432}],[{"start":{"row":175,"column":0},"end":{"row":175,"column":12},"action":"remove","lines":["<<<<<<< HEAD"],"id":433}],[{"start":{"row":174,"column":24},"end":{"row":175,"column":0},"action":"remove","lines":["",""],"id":434}],[{"start":{"row":178,"column":0},"end":{"row":185,"column":25},"action":"remove","lines":["=======","    if [ -z \"${IMAGE_VOLUME}\" ]","    then","        echo CREATING A NEW DOCKER VOLUME &&","            IMAGE_VOLUME=$(sudo docker volume create --label moniker=${MONIKER} --label expiry=$(($(date +%s)+60*60*24*7)))","    else","        echo USING A CACHED DOCKER VOLUME",">>>>>>> only cache images"],"id":435}],[{"start":{"row":177,"column":122},"end":{"row":178,"column":0},"action":"remove","lines":["",""],"id":436}],[{"start":{"row":187,"column":0},"end":{"row":187,"column":12},"action":"remove","lines":["<<<<<<< HEAD"],"id":437}],[{"start":{"row":186,"column":33},"end":{"row":187,"column":0},"action":"remove","lines":["",""],"id":438}],[{"start":{"row":188,"column":0},"end":{"row":190,"column":25},"action":"remove","lines":["=======","        --volume ${IMAGE_VOLUME}:/var/lib/docker/image \\",">>>>>>> only cache images"],"id":439}],[{"start":{"row":187,"column":53},"end":{"row":188,"column":0},"action":"remove","lines":["",""],"id":440}]]},"ace":{"folds":[],"scrolltop":2783,"scrollleft":0,"selection":{"start":{"row":187,"column":53},"end":{"row":187,"column":53},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":197,"state":"start","mode":"ace/mode/sh"}},"timestamp":1519590957565}